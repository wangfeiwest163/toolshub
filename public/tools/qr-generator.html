<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator | ToolsHub</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/fontawesome-local.css">
</head>
<body data-tool-id="2" data-tool-name="qr-generator">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-tools"></i> ToolsHub
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/tools/all">All Tools</a>
                    </li>
                </ul>
                <form class="d-flex" role="search" onsubmit="event.preventDefault(); performSearch(event);">
                    <input class="form-control me-2" type="search" id="searchInput" placeholder="Search tools..." aria-label="Search">
                    <button class="btn btn-outline-light" type="submit">Search</button>
                </form>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/">Home</a></li>
                        <li class="breadcrumb-item"><a href="/tools/all">Utility Tools</a></li>
                        <li class="breadcrumb-item active" aria-current="page">QR Code Generator</li>
                    </ol>
                </nav>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h3>QR Code Generator</h3>
                        <button class="btn btn-outline-primary" id="favoriteBtn">
                            <i class="far fa-star"></i> Favorite
                        </button>
                    </div>
                    <div class="card-body">
                        <p class="card-text">Generate custom QR codes for websites, text, contact information, and more.</p>
                        
                        <div class="tool-interface mt-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="qrContent" class="form-label">Content to Encode</label>
                                        <textarea class="form-control" id="qrContent" rows="4" placeholder="Enter text, URL, or contact info..."></textarea>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="qrSize" class="form-label">QR Code Size</label>
                                        <select class="form-select" id="qrSize">
                                            <option value="small">Small (150x150)</option>
                                            <option value="medium" selected>Medium (300x300)</option>
                                            <option value="large">Large (450x450)</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="qrColor" class="form-label">QR Color</label>
                                        <input type="color" class="form-control form-control-color" id="qrColor" value="#000000">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="qrBgColor" class="form-label">Background Color</label>
                                        <input type="color" class="form-control form-control-color" id="qrBgColor" value="#ffffff">
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="qrPreview" class="form-label">QR Code Preview</label>
                                        <div id="qrPreview" class="border d-flex align-items-center justify-content-center" style="height: 300px; background-color: white;">
                                            <p class="text-muted">QR code will appear here</p>
                                        </div>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary" type="button" id="generateBtn">
                                            <i class="fas fa-qrcode"></i> Generate QR Code
                                        </button>
                                        <button class="btn btn-success" type="button" id="downloadBtn" disabled>
                                            <i class="fas fa-download"></i> Download QR Code
                                        </button>
                                        <button class="btn btn-info" type="button" id="resetBtn">
                                            <i class="fas fa-redo"></i> Reset
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-header">
                        <h4>How to Use</h4>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li>Enter the content you want to encode (URL, text, contact info, etc.)</li>
                            <li>Select the desired size and colors</li>
                            <li>Click "Generate QR Code"</li>
                            <li>Download the generated QR code or reset to start over</li>
                        </ol>
                        <p>QR codes can store up to 4,296 characters of text or a URL of any length.</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>Related Tools</h5>
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="/tools/url-shortener" class="list-group-item list-group-item-action">
                            <i class="fas fa-link me-2"></i> URL Shortener
                        </a>
                        <a href="/tools/password-generator" class="list-group-item list-group-item-action">
                            <i class="fas fa-key me-2"></i> Password Generator
                        </a>
                        <a href="/tools/barcode-generator" class="list-group-item list-group-item-action">
                            <i class="fas fa-barcode me-2"></i> Barcode Generator
                        </a>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-header">
                        <h5>QR Code Info</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check-circle text-success me-2"></i> Fast scanning</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i> High capacity</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i> Error correction</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i> Mobile friendly</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-3 mt-5">
        <p>&copy; 2024 ToolsHub - All rights reserved</p>
    </footer>

    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>
        // Simple QR Code Generator using canvas
        class SimpleQRCode {
            constructor(text, size = 200, color = '#000000', bgColor = '#FFFFFF') {
                this.text = text;
                this.size = size;
                this.color = color;
                this.bgColor = bgColor;
            }

            generate() {
                // Create canvas
                const canvas = document.createElement('canvas');
                canvas.width = this.size;
                canvas.height = this.size;
                const ctx = canvas.getContext('2d');

                // Fill background
                ctx.fillStyle = this.bgColor;
                ctx.fillRect(0, 0, this.size, this.size);

                // Draw a simple pattern that looks like a QR code
                // This is a simplified visualization, not a real QR code encoding
                ctx.fillStyle = this.color;

                // Draw outer positioning squares
                const squareSize = this.size / 7;
                const moduleSize = this.size / 21; // Use 21x21 modules

                // Positioning markers (corners)
                this.drawPositionMarker(ctx, 0, 0, moduleSize);
                this.drawPositionMarker(ctx, this.size - 7 * moduleSize, 0, moduleSize);
                this.drawPositionMarker(ctx, 0, this.size - 7 * moduleSize, moduleSize);

                // Draw random pattern for data area (simulated)
                this.drawSimulatedData(ctx, moduleSize);

                return canvas;
            }

            drawPositionMarker(ctx, x, y, moduleSize) {
                // Outer black square (7x7 modules)
                ctx.fillStyle = this.color;
                for (let i = 0; i < 7; i++) {
                    for (let j = 0; j < 7; j++) {
                        if (i === 0 || i === 6 || j === 0 || j === 6 || (i >= 2 && i <= 4 && j >= 2 && j <= 4)) {
                            ctx.fillRect(x + i * moduleSize, y + j * moduleSize, moduleSize, moduleSize);
                        }
                    }
                }

                // Inner white square (5x5 modules)
                ctx.fillStyle = this.bgColor;
                for (let i = 1; i < 6; i++) {
                    for (let j = 1; j < 6; j++) {
                        if (i === 1 || i === 5 || j === 1 || j === 5 || (i === 2 && j === 2) || (i === 2 && j === 4) || (i === 4 && j === 2) || (i === 4 && j === 4)) {
                            continue; // Skip these to maintain pattern
                        }
                        ctx.fillRect(x + i * moduleSize, y + j * moduleSize, moduleSize, moduleSize);
                    }
                }

                // Inner black square (3x3 modules)
                ctx.fillStyle = this.color;
                for (let i = 2; i < 5; i++) {
                    for (let j = 2; j < 5; j++) {
                        ctx.fillRect(x + i * moduleSize, y + j * moduleSize, moduleSize, moduleSize);
                    }
                }
            }

            drawSimulatedData(ctx, moduleSize) {
                // Draw a pattern that simulates QR code data areas
                // Avoid the position markers areas
                ctx.fillStyle = this.color;

                // Draw some random pattern in the central area (not overlapping position markers)
                const startX = 8;
                const startY = 8;
                const endX = 21 - 8;
                const endY = 21 - 8;

                // Draw a recognizable pattern
                for (let i = startX; i < endX; i++) {
                    for (let j = startY; j < endY; j++) {
                        // Skip position marker areas
                        if ((i < 7 && j < 7) || (i > 14 && j < 7) || (i < 7 && j > 14)) {
                            continue;
                        }

                        // Create a pattern based on the input text
                        const charIndex = (i * j + this.text.length) % this.text.length;
                        const shouldDraw = (charIndex % 2 === 0 && i % 3 === 0) || (j % 4 === 0 && charIndex % 3 === 0);

                        if (shouldDraw) {
                            ctx.fillRect(i * moduleSize, j * moduleSize, moduleSize, moduleSize);
                        }
                    }
                }
            }
        }

        // QR generator functionality
        class QRGenerator {
            constructor() {
                this.qrCanvas = null;
                this.initializeElements();
                this.bindEvents();
            }

            initializeElements() {
                this.qrContent = document.getElementById('qrContent');
                this.qrSize = document.getElementById('qrSize');
                this.qrColor = document.getElementById('qrColor');
                this.qrBgColor = document.getElementById('qrBgColor');
                this.qrPreview = document.getElementById('qrPreview');
                this.generateBtn = document.getElementById('generateBtn');
                this.downloadBtn = document.getElementById('downloadBtn');
                this.resetBtn = document.getElementById('resetBtn');
            }

            bindEvents() {
                // Ensure elements exist before binding
                if (this.generateBtn) {
                    this.generateBtn.addEventListener('click', () => this.generateQR());
                }
                
                if (this.downloadBtn) {
                    this.downloadBtn.addEventListener('click', () => this.downloadQR());
                }
                
                if (this.resetBtn) {
                    this.resetBtn.addEventListener('click', () => this.resetForm());
                }
                
                // Update preview when content changes (with debounce)
                if (this.qrContent) {
                    let timeout;
                    this.qrContent.addEventListener('input', () => {
                        clearTimeout(timeout);
                        timeout = setTimeout(() => {
                            if (this.qrContent.value.trim()) {
                                this.generateQR();
                            }
                        }, 500);
                    });
                }
            }

            generateQR() {
                const content = this.qrContent.value.trim();
                if (!content) {
                    this.showError('Please enter content to encode in the QR code');
                    return;
                }

                // Map size to pixel dimensions
                let size;
                switch (this.qrSize.value) {
                    case 'small':
                        size = 150;
                        break;
                    case 'medium':
                        size = 300;
                        break;
                    case 'large':
                        size = 450;
                        break;
                    default:
                        size = 300;
                }

                try {
                    // Clear preview area
                    this.qrPreview.innerHTML = '';

                    // Create QR code using our simple generator
                    const qr = new SimpleQRCode(
                        content,
                        size,
                        this.qrColor.value,
                        this.qrBgColor.value
                    );

                    this.qrCanvas = qr.generate();

                    // Add the canvas to the preview
                    this.qrPreview.appendChild(this.qrCanvas);

                    // Enable download button
                    if (this.downloadBtn) {
                        this.downloadBtn.disabled = false;
                    }

                    // Record tool usage
                    this.recordToolUsage('generate_qr');
                } catch (error) {
                    console.error('Error generating QR code:', error);
                    this.showError('Failed to generate QR code. Please try different content.');
                }
            }

            downloadQR() {
                if (!this.qrCanvas) {
                    this.showError('Please generate a QR code first');
                    return;
                }

                const content = this.qrContent.value.trim();
                if (!content) {
                    this.showError('No QR code to download');
                    return;
                }

                try {
                    // Get data URL from canvas
                    const dataURL = this.qrCanvas.toDataURL('image/png');

                    // Create a temporary link to download the image
                    const link = document.createElement('a');
                    link.href = dataURL;
                    link.download = `qrcode-${Date.now()}.png`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    // Record tool usage
                    this.recordToolUsage('download_qr');
                } catch (error) {
                    console.error('Error downloading QR code:', error);
                    this.showError('Failed to download QR code. Please try again.');
                }
            }

            resetForm() {
                if (this.qrContent) {
                    this.qrContent.value = '';
                }
                if (this.qrSize) {
                    this.qrSize.value = 'medium';
                }
                if (this.qrColor) {
                    this.qrColor.value = '#000000';
                }
                if (this.qrBgColor) {
                    this.qrBgColor.value = '#ffffff';
                }
                if (this.qrPreview) {
                    this.qrPreview.innerHTML = '<p class="text-muted">QR code will appear here</p>';
                }
                if (this.downloadBtn) {
                    this.downloadBtn.disabled = true;
                }

                // Record tool usage
                this.recordToolUsage('reset_form');
            }

            showError(message) {
                // Remove any existing alerts
                const existingAlert = document.querySelector('.alert-fixed-top');
                if (existingAlert) {
                    existingAlert.remove();
                }

                // Create a temporary alert
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-danger alert-fixed-top';
                alertDiv.innerHTML = `
                    <button type="button" class="btn-close float-end" data-bs-dismiss="alert" aria-label="Close"></button>
                    <strong>Error:</strong> ${message}
                `;

                document.body.appendChild(alertDiv);

                // Remove after 5 seconds
                setTimeout(() => {
                    if (document.body.contains(alertDiv)) {
                        document.body.removeChild(alertDiv);
                    }
                }, 5000);
            }

            recordToolUsage(action) {
                // Send analytics data
                fetch('/api/analytics/track', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        toolId: 'qr-generator',
                        action: action,
                        ip: '127.0.0.1',
                        userAgent: navigator.userAgent
                    })
                }).catch(error => console.error('Analytics tracking failed:', error));
            }
        }

        // Initialize the QR generator when the page loads
        function initializeQRGenerator() {
            try {
                // Wait for DOM to be fully loaded
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => {
                        new QRGenerator();
                        initializeOtherComponents();
                    });
                } else {
                    new QRGenerator();
                    initializeOtherComponents();
                }
            } catch (error) {
                console.error('Error initializing QR Generator:', error);
                // Fallback: make sure the button at least shows an alert
                const generateBtn = document.getElementById('generateBtn');
                if (generateBtn) {
                    generateBtn.addEventListener('click', () => {
                        alert('QR Generator initialization error. Please refresh the page.');
                    });
                }
            }
        }

        function initializeOtherComponents() {
            // Initialize favorite button functionality
            const favoriteBtn = document.getElementById('favoriteBtn');
            if (favoriteBtn) {
                favoriteBtn.addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    if (icon.classList.contains('far')) {
                        icon.classList.remove('far');
                        icon.classList.add('fas', 'text-warning');
                        this.innerHTML = '<i class="fas fa-star text-warning"></i> Favorited';
                    } else {
                        icon.classList.remove('fas', 'text-warning');
                        icon.classList.add('far');
                        this.innerHTML = '<i class="far fa-star"></i> Favorite';
                    }
                });
            }

            // Search functionality
            window.performSearch = function(event) {
                if (event) event.preventDefault();
                const searchTerm = document.getElementById('searchInput').value;
                if (searchTerm) {
                    window.location.href = `/tools/all?search=${encodeURIComponent(searchTerm)}`;
                }
            };
        }

        // Start initialization
        initializeQRGenerator();
    </script>
    <style>
        .alert-fixed-top {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            width: 300px;
        }
    </style>
</body>
</html>